# 基于半径约束的空间抽稀与合并方案（Radius-based Spatial Thinning & Merge）

## 1. 技术方案说明

针对 3D Gaussian Splatting（3DGS）数据在高密度区域存在大量空间冗余、传统体素抽稀方法易产生格子感与结构伪影的问题，提出一种**基于半径约束的空间抽稀与合并方案**。

该方案以**空间距离约束**作为核心准则，通过设定最小空间间距（半径阈值），对高斯点进行逐点筛选与合并处理。算法优先保留对视觉贡献较大的高斯点，并在其空间邻域内抑制冗余点，从而实现空间分布的均匀化。

为保证在大规模数据场景下的计算效率，引入**哈希网格（Hash Grid）**作为空间加速结构，将三维空间划分为边长等于半径阈值的规则单元，仅在当前单元及其相邻单元内进行近邻查询，在保证结果完整性的前提下，将计算复杂度控制在近似线性范围内。

当某一高斯点的半径邻域内已存在代表点时，其几何与属性参数将按权重合并至该代表点；若不存在，则该高斯点作为新的代表点保留。合并完成后，对高斯尺度施加上限约束，避免因多点融合导致尺度异常膨胀，从而保证渲染稳定性。

该方案不依赖规则体素边界，不引入多层级 LOD 或信息论距离度量，适用于大规模 3DGS 数据的离线抽稀与工程级优化处理。

---

## 2. 算法流程（Algorithm）

**输入：**  
- 高斯点集合  
- 半径阈值 \( r \)

**输出：**  
- 抽稀并合并后的高斯点集合

**步骤：**

1. **重要性排序**  
   根据不透明度与局部尺度等指标对高斯点进行排序，优先处理视觉贡献较大的点。

2. **空间哈希构建**  
   将空间划分为边长为 \( r \) 的网格单元，并通过哈希映射建立空间索引。

3. **半径邻域判定**  
   对每个高斯点，仅在其所在网格单元及其相邻的 27 个网格单元中进行近邻搜索。

4. **抽稀与合并**  
   - 若半径 \( r \) 内不存在代表点，则该点作为新的代表点保留；
   - 若存在代表点，则将该点按权重合并至对应代表点。

5. **尺度约束与参数更新**  
   对合并后的高斯尺度施加上限约束，输出最终高斯集合。

---

## 3. 数学与公式说明（Mathematical Formulation）

### 3.1 高斯点表示

设输入高斯点集合为：

 $$\[\mathcal{G} = \{ g_i \mid g_i = (\mathbf{x}_i, \boldsymbol{\Sigma}_i, \mathbf{f}_i, \alpha_i) \}\]$$

其中：
- $$\( \mathbf{x}_i \in \mathbb{R}^3 \)$$ ：高斯中心位置  
- $$\( \boldsymbol{\Sigma}_i \)$$ ：尺度或协方差近似  
- $$\( \mathbf{f}_i \)$$ ：颜色或 SH 特征  
- $$\( \alpha_i \)$$ ：不透明度  

---

### 3.2 半径约束判定

对于高斯点 $$\( g_i \)$$，若存在代表点 $$\( g_j \)$$ 满足：

$$\[\|\mathbf{x}_i - \mathbf{x}_j\|_2 \le r\]$$

则认为两者在空间上冗余，需要执行合并操作；否则， $$\( g_i \)$$ 作为新的代表点保留。

---

### 3.3 权重定义

合并权重定义为：

$$
\[
w_i = \alpha_i
\]
$$

（工程中可扩展为 $$\( w_i = \alpha_i \cdot s_i \)，其中 \( s_i \)$$ 表示局部尺度因子。）

---

### 3.4 位置与特征合并

**位置合并：**

$$
\[
\mathbf{x}_{\text{new}} =
\frac{\sum_i w_i \mathbf{x}_i}{\sum_i w_i}
\]
$$

**特征合并（颜色 / SH）：**

$$
\[
\mathbf{f}_{\text{new}} =
\frac{\sum_i w_i \mathbf{f}_i}{\sum_i w_i}
\]
$$

---

### 3.5 不透明度融合

采用乘法模型进行融合：

$$
\[
\alpha_{\text{new}} = 1 - \prod_i (1 - \alpha_i)
\]
$$

该方式能够保持遮挡关系的一致性。

---

### 3.6 尺度合并与约束

位置方差估计：

$$
\[
\boldsymbol{\sigma}^2_{\text{pos}} =
\mathbb{E}[\mathbf{x}^2] - \mathbf{x}_{\text{new}}^2
\]
$$

尺度融合：

$$
\[
\boldsymbol{\sigma}^2_{\text{new}} =
\boldsymbol{\sigma}^2_{\text{pos}} + \mathbb{E}[\boldsymbol{\Sigma}_i^2]
\]
$$

并引入尺度上限约束：

$$
\[
\boldsymbol{\Sigma}_{\text{new}} \le k \cdot \mathbb{E}[\boldsymbol{\Sigma}_i]
\]
$$

其中 $$\( k \)$$ 为经验系数，用于防止尺度异常膨胀。

---

### 3.7 哈希网格与 27 邻域

当网格单元边长设置为 $$\( r \)$$ 时，任意距离不超过 $$\( r \)$$ 的点，其网格索引在三个坐标轴方向上的偏移范围为 $$\([-1, 1]\)$$。  
因此，仅需检查：

$$
\[
3 \times 3 \times 3 = 27
\]
$$

个相邻网格单元即可保证不遗漏任何潜在近邻点。

---

## 4. 计算复杂度分析（Computational Complexity）

设输入点数为 \( N \)，抽稀后代表点数为 \( M \)（通常 \( M \ll N \)）。

- **排序阶段：**  
 $$\[
  O(N \log N)
  \] $$

- **半径抽稀与合并阶段（哈希网格加速）：**  
  平均情况下，每个点仅检查常数数量的候选点：  
 $$\[
  O(N)
  \]$$

- **总体时间复杂度：**  
 $$\[
  O(N \log N)
  \]$$

- **空间复杂度：**  
$$\[
  O(N)
  \]$$

---

## 5. 技术效果与方案优势

### 5.1 视觉效果优势
- 消除规则体素抽稀带来的格子感  
- 抑制高密度区域高斯点的堆叠与重影  
- 保持场景结构连续性与边界稳定性  

### 5.2 工程与性能优势
- 近似线性复杂度，适合百万级甚至千万级数据  
- 哈希网格结构简单，易于 CPU / WASM / GPU 实现  
- 不依赖复杂协方差分解或 KL 距离计算，数值稳定  

### 5.3 方法通用性
- 不引入多层级 LOD，适用于单层模型优化  
- 可作为 3DGS 数据预处理、压缩与加载优化模块  
- 易于与渲染调度、流式加载等系统解耦集成  

---

## 6. 总结

**基于半径约束的空间抽稀与合并方案**通过空间距离抑制冗余高斯点，在不依赖规则体素划分和信息论度量的前提下，实现了高质量、可扩展的 3D Gaussian 数据抽稀方法，兼顾视觉效果与工程性能，适合在大规模 3DGS 系统中落地应用。
